## [Start] Authorization rules. **
#if( $util.authType() == "IAM Authorization" && $util.isNull($ctx.identity.cognitoIdentityPoolId) && $util.isNull($ctx.identity.cognitoIdentityId) )
  $util.qr($ctx.stash.put("hasAuth", true))
  $util.toJson({"version":"2018-05-29","payload":{}})
#else
  $util.qr($ctx.stash.put("hasAuth", true))
  #set( $authRules = [] )
  #if( $ctx.stash.adminRoles && $ctx.stash.adminRoles.size() > 0 )
    $util.qr($authRules.add({
  "provider": "iam",
  "type": "admin",
  "strict": false,
  "roles": $ctx.stash.adminRoles
}))
  #end
  $util.qr($authRules.add({
  "type": "private",
  "provider": "userPools"
}))
  #set( $authResult = $util.authRules.subscriptionAuth($authRules) )
  #if( !$authResult || ($authResult && !$authResult.authorized) )
    $util.unauthorized()
  #end
  #if( $authResult && !$util.isNullOrEmpty($authResult.authFilter) )
    #if( $util.isNullOrEmpty($ctx.args.filter) )
      #set( $ctx.args.filter = $authResult.authFilter )
    #else
      #set( $ctx.args.filter = {
  "and":   [$authResult.authFilter, $ctx.args.filter]
} )
    #end
  #end
  $util.toJson({"version":"2018-05-29","payload":{}})
#end
## [End] Authorization rules. **